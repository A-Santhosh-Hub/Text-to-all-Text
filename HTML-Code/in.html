        function applyTheme() {
            // If settings aren't loaded (fresh visit), check system preference
            if (!localStorage.getItem('sanstudio_texttool_config')) {
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.classList.add('dark');
                }
            }
        }

        function updateSettingsFromUI() {
            saveSettings();
        }

        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            saveSettings();
        }

        // Drag helpers
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        function handleDrop(e) {
            preventDefaults(e);
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFileUpload(files[0]);
        }
